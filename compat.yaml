imports:
  - plugin.yaml

dsl_definitions:

  common_config: &common_config
    use_compact_node:
      description: This to indicate that this node is going to be converted to openstack version 3.0.0 node
      type: boolean
      default: true
    openstack_config:
      default: {}
    resource_id:
      default: ''


node_types:

  cloudify.openstack.nodes.Flavor:
    derived_from: cloudify.nodes.openstack.Flavor
    properties:
      <<: *common_config
      flavor:
        default: {}
      # extra_specs will be ignore on new SDK since it does not support set set keys for flavor
      extra_specs:
        default: {}
      # tenants will be ignore on new SDK since it does not support add tenant access
      tenants:
        default: []

  cloudify.openstack.nodes.HostAggregate:
    derived_from: cloudify.nodes.openstack.HostAggregate
    properties:
      <<: *common_config
      aggregate:
        default: {}

  cloudify.openstack.nodes.Image:
    derived_from: cloudify.nodes.openstack.Image
    properties:
      <<: *common_config
      image:
        default: {}

  cloudify.openstack.nodes.KeyPair:
    derived_from: cloudify.nodes.openstack.KeyPair
    properties:
      <<: *common_config
      keypair:
        default: {}
      # Openstack 3.x.x does not support generating private key file, this property will be ignored
      private_key_path:
        type: string
        default: ''

  cloudify.openstack.nodes.ServerGroup:
    derived_from: cloudify.nodes.openstack.ServerGroup
    properties:
      <<: *common_config
      server_group:
        default: {}
      policy:
        type: string
        description: >
          the policy of the server group, this must be either 'affinity',
          'anti-affinity', 'soft-affinity', or 'soft-anti-affinity'.


  cloudify.openstack.nodes.Server:
    derived_from: cloudify.nodes.openstack.Server
    properties:
      <<: *common_config
      server:
        default: {}
      # This is no longer supported by the new SDK
      management_network_name:
          type: string
          required: false
          description: >
            Old requirement called management network name. Not required. Leave blank. Retained for backward compatibility.
            Not every server need be connected to a management network.
            If the management network's name information is available in the Provider Context,
            this connection is made automatically and there's no need to override this property
            (See the Misc section for more information on the Openstack Provider Context).
            It is not required to set the value of this property to the management network name. As of Cloudify 4.0, it has no relationship to the bootstrap process.




  cloudify.openstack.nodes.User:
    derived_from: cloudify.nodes.openstack.User
    properties:
      <<: *common_config
      user:
        default: {}

  cloudify.openstack.nodes.Project:
    derived_from: cloudify.nodes.openstack.Project
    properties:
      <<: *common_config
      project:
        default: {}

  cloudify.openstack.nodes.Volume:
    derived_from: cloudify.nodes.openstack.Volume
    properties:
      <<: *common_config
      volume:
        default: {}
      # In new SDK, this property is going to be ignored because when user
      # specify "imageRef" in volume, that means the volume is bootable and
      # for backward compatibility, the new SDK store runtime property
      # called "bootable" to give an indication if this volume is bootable
      # or not when it is connected to the server via relationship
      boot:
        type: boolean
        required: false
        description: >
          If a Server instance is connected to this Volume by a relationship,
          this volume will be used as the boot volume for that Server.
          This option will be deprecated in the future.


relationships:

  cloudify.openstack.volume_attached_to_server:
    derived_from: cloudify.relationships.openstack.volume_attached_to_server